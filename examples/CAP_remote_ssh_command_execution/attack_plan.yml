  - emulation_plan_details:
      adversary_name: test
      creation_time: 2024-11-11 02:17:35 UTC+0000
  - uuid: dc3488b0-08c7-4fea-b585-905c83b48180
    name: Malicious User Agents - CMD
    id: T1071.001
    source: ART
    supported_platforms:
      - windows
    tactics:
      - Command and Control
    technique: 'Application Layer Protocol: Web Protocols'
    description: |
      This test simulates an infected host beaconing to command and control. Upon execution, no out put will be displayed. 
      Use an application such as Wireshark to record the session and observe user agent strings and responses.

      Inspired by APTSimulator - https://github.com/NextronSystems/APTSimulator/blob/master/test-sets/command-and-control/malicious-user-agents.bat
    executor:
      command: |
        #{curl_path} -s -A "HttpBrowser/1.0" -m3 #{domain} >nul 2>&1
        #{curl_path} -s -A "Wget/1.9+cvs-stable (Red Hat modified)" -m3 #{domain} >nul 2>&1
        #{curl_path} -s -A "Opera/8.81 (Windows NT 6.0; U; en)" -m3 #{domain} >nul 2>&1
        #{curl_path} -s -A "*<|>*" -m3 #{domain} >nul 2>&1
      name: command_prompt
    arguments:
      domain:
        description: Default domain to simulate against
        type: string
        default: www.google.com
      curl_path:
        description: path to curl.exe
        type: path
        default: C:\Windows\System32\Curl.exe
    dependencies:
      - description: |
          Curl must be installed on system 
        prereq_command: |
          if (Test-Path #{curl_path}) {exit 0} else {exit 1}
        get_prereq_command: |
          New-Item -Type Directory "PathToAtomicsFolder\..\ExternalPayloads\" -ErrorAction Ignore -Force | Out-Null
          Invoke-WebRequest "https://curl.se/windows/dl-8.6.0_2/curl-8.6.0_2-win32-mingw.zip" -Outfile "PathToAtomicsFolder\..\ExternalPayloads\curl.zip"
          Expand-Archive -Path "PathToAtomicsFolder\..\ExternalPayloads\curl.zip" -DestinationPath "PathToAtomicsFolder\..\ExternalPayloads\curl"
          Copy-Item "PathToAtomicsFolder\..\ExternalPayloads\curl\curl-8.6.0_2-win32-mingw\bin\curl.exe" #{curl_path}
           Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\curl"
          Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\curl.zip"
  - uuid: 9e8894c0-50bd-4525-a96c-d4ac78ece388
    name: Create and Execute Batch Script
    id: T1059.003
    source: ART
    supported_platforms:
      - windows
    tactics:
      - Execution
    technique: 'Command and Scripting Interpreter: Windows Command Shell'
    description: |
      Creates and executes a simple batch script. Upon execution, CMD will briefly launch to run the batch script then close again.
    executor:
      command: |
        Start-Process "#{script_path}"
      cleanup_command: |
        Remove-Item "#{script_path}" -Force -ErrorAction Ignore
      name: powershell
    arguments:
      command_to_execute:
        description: Command to execute within script.
        type: string
        default: dir
      script_path:
        description: Script path.
        type: path
        default: PathToAtomicsFolder\..\ExternalPayloads\T1059.003_script.bat
    dependencies:
      - description: |
          Batch file must exist on disk at specified location (#{script_path})
        prereq_command: |
          if (Test-Path "#{script_path}") {exit 0} else {exit 1}
        get_prereq_command: |
          New-Item "#{script_path}" -Force | Out-Null
          Set-Content -Path "#{script_path}" -Value "#{command_to_execute}"
  - uuid: 19acf63b-55c4-4b6a-8552-00a8865105c8
    name: UltraViewer - RAT Execution
    id: T1219
    source: ART
    supported_platforms:
      - windows
    tactics:
      - Command and Control
    technique: Remote Access Software
    description: |
      A recent trend by threat actors, once a foothold is established, maintain long term persistence using third party remote services such as UltraViewer to provide the operator with access to the network using legitimate services. 
    executor:
      command: |
        Start-Process -Wait -FilePath "#{UltraViewer_Path}" -Argument "/silent" -PassThru
        Start-Process 'C:\Program Files (x86)\UltraViewer\UltraViewer_Desktop.exe'
      cleanup_command: |
        Stop-Process -Name "UltraViewer_Desktop" -Force -ErrorAction SilentlyContinue
      name: powershell
      elevation_required: true
    arguments:
      UltraViewer_Path:
        description: Path to the UltraViewer executable.
        type: path
        default: PathToAtomicsFolder\..\ExternalPayloads\T1219_UltraViewer.exe
    dependencies:
      - description: |
          Ultraviewer installer must be downloaded and exist on the disk at the specified location. (#{UltraViewer_Path})
        prereq_command: |
          if (Test-Path "#{UltraViewer_Path}") {exit 0} else {exit 1}
        get_prereq_command: |
          New-Item -Type Directory "PathToAtomicsFolder\..\ExternalPayloads\" -ErrorAction Ignore -Force | Out-Null
          (New-Object Net.WebClient).DownloadFile("https://www.ultraviewer.net/en/UltraViewer_setup_6.5_en.exe","#{UltraViewer_Path}")
