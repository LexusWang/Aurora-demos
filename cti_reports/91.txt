1. Introduction to CVE-2017-11882 Vulnerability
Recently, Antian detected multiple targeted attacks exploiting the CVE-2017-11882 vulnerability. This vulnerability is simple in principle, stable in exploitation, and can be executed without user interaction or awareness. It is commonly used in spear-phishing and watering-hole attacks. For example, the Cobalt group has recently been sending spear-phishing emails with malicious RTF attachments. When the victim opens the attachment, the vulnerability is triggered to download a malicious payload for the attack.

CVE-2017-11882 is a critical remote code execution vulnerability in Microsoft Office, specifically in the Equation Editor module EQNEDT32.EXE (which is used to insert and edit equations in documents and is installed by default with Office). This vulnerability has quietly existed for 17 years and affects all major Microsoft Office versions currently in use (Office 2007 SP3, Office 2010 SP2, Office 2013 SP1, Office 2016). Attackers can leverage this flaw to execute arbitrary code in the context of the currently logged-in user, making it highly stealthy. Exploit details for this vulnerability have already been publicly disclosed, and exploit activity is expected to increase.

Microsoft released a patch for this vulnerability on November 14, 2017, as part of their November security update. Users are strongly advised to apply this patch promptly. The patch download link is:
https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-11882

Antian’s PTA (Threat Analysis) system can detect samples exploiting this vulnerability, and combined with Antian’s IEP (Endpoint Protection System), can provide effective protection against such threats.

2. Antian PTA Detection of Samples
Antian PTA is equipped with the AVL SDK threat detection engine developed in-house, which employs a combination of static and dynamic analysis for deep file inspection.

Static analysis: The AVL SDK deeply parses Office file structures, finely restoring the file content and extracting OLE (Object Linking and Embedding) components. This allows precise identification of malicious files that trigger the vulnerability, providing accurate detection results for subsequent defense.

Dynamic analysis: The files under inspection are executed in a simulated environment with virtual machines equipped to mimic user operations (to induce malicious code behavior in unknown files). This restores the true runtime environment of the sample, monitors its execution and all process activities, and conducts detailed analysis of its code characteristics and attack behavior, effectively triggering the exploit and detecting anomalies.

During the analysis of samples exploiting CVE-2017-11882, key attack steps were identified as shown in the diagram below:

Figure 1: Key steps in attacks exploiting CVE-2017-11882

Based on the above attack process, Antian PTA provided the following analysis results for one sample exploiting this vulnerability:

Figure 2: Partial screenshot of detection report generated by Antian PTA

From the detection report, the detailed analysis reveals:

Antian PTA dynamically captured OLE behavior from the sample.
The sample uses OLE to insert formulas into the document, triggering a buffer overflow in the Equation Editor EQNEDT32.EXE. When the buffer overflow occurs, execution jumps to a malicious shellcode segment that downloads and executes the malicious payload.

Antian PTA’s dynamic analyzer intercepted HTTP requests for downloading the malicious payload.

The detected behaviors and exploitation details fully match the characteristics of CVE-2017-11882 exploitation. Therefore, PTA’s assessment classifies this sample as a suspected advanced threat.

3. Antian Threat Defense Solutions
The detailed reports generated by Antian PTA’s deep analysis can serve as important leads. These reports work collaboratively with Antian’s independently developed Zhijia Endpoint Protection System, ZhenGuan Next-Generation Firewall, Tanhai Threat Detection System, Situational Awareness Platform, and third-party security products to achieve malicious program monitoring, analysis, blocking, and judgment. This integrated defense effectively protects against infectious viruses, worms, trojans, ransomware, and attacks involving formatted documents.

For malicious shellcode, Antian Zhijia can implement proactive defense measures such as malicious file detection and removal, as well as patching the CVE-2017-11882 vulnerability.

3.1 Malicious File Detection and Removal

3.2 CVE-2017-11882 Vulnerability Patch
Antian Zhijia provides Office vulnerability patches specifically targeting CVE-2017-11882. Administrators can deploy patch commands through the management center, eliminating the need for manual updates on individual endpoints, ensuring uninterrupted normal office application usage.

4. Capabilities and Value of Antian PTA
Antian PTA is a deep analysis device that brings Antian’s backend core automated analysis capabilities to the user side. It performs both dynamic and static in-depth analysis and identification on objects such as files and URLs, comprehensively assessing their reputation. It can effectively trigger 0-day vulnerabilities, detect stealthy trojans and advanced attack samples, finely reveal file behaviors, and output threat intelligence and detailed analysis reports.

4.1 Multi-Engine Deep Detection
Antian PTA integrates multiple identification engines internally, capable of conducting in-depth security analysis on document files, executable files, URLs, and other objects, effectively detecting various known and unknown threats.

4.2 Multi-Environment Dynamic Analysis
Antian PTA supports multiple detection environments. The optimal combination of multiple operating systems and software versions can accurately restore the real execution environment of samples. Different simulation response techniques enable triggering more behaviors during sample execution, acquiring richer runtime data.

4.3 Multi-Device Collaborative Protection
Antian PTA not only supports linkage with its own products but also provides standardized interfaces to integrate with third-party security products (firewalls, UTM devices, etc.), mail servers, OA systems, and more. PTA offers deep analysis capabilities for malicious programs; its analytical results can be fed back as detection clues to third-party devices to block malicious program propagation in real time and with high accuracy. In addition, PTA can output analysis reports to help users fully understand the outbreak and spread of malicious programs.

4.4 Detailed Identification Reports
After sample files are identified by Antian PTA, detailed analysis reports can be generated. These reports record various identification information of the analyzed files and present the basis for judgment, providing users with more evidence for defense.

4.5 Product Value Delivery
Antian PTA provides users with localized, reliable deep identification capabilities. Its highly realistic dynamic sandbox can effectively trigger exploit vulnerabilities, deeply reveal malicious behaviors, and present comprehensive and detailed analysis reports. It outputs high-value threat intelligence, providing accurate and rich data foundations for manual analysis.